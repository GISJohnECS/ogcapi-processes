[#clause_wps,reftext='11']
[[Clause_WPS]]
== REST/JSON Binding

In the following sections, the resources and endpoint-URLs of the WPS 2.0 REST/JSON binding are described.

=== Resources to be provided by WPS

The resources that are provided by a WPS REST server are listed in <<table_wps_resources>> below and include the
capabilities document of the server, the list of processes available
(ProcessCollection and Process), jobs (running processes) and
outputs of processes.

[#table_wps_resources,reftext='{table-caption} {counter:table-num}']
.Resources provided by the WPS REST server
[options="header"]
|=======================
|Resource Class         |Description                                |Acccess Path                           
|Capabilities           |The complete service metadata document.    |{WpsRESTBaseURL}
|ProcessCollection           |List of processes available                |{WpsRESTBaseURL}/processes       
|Process | Detailed process description of a single process |{WpsRESTBaseURL}/processes/{process-id} 
|JobCollection | List of jobs of a process  |{WpsRESTBaseURL}/processes/{processID}/jobs 
|Job |Representation of a job (execution of a process) containing status information |{WpsRESTBaseURL}/processes/{processID}/jobs/{job-id} 
|Process Output Data |Resource containing the different process outputs inline or as reference. |{WpsRESTBaseURL}/processes/{processID}/jobs/{job-id}/outputs
3+^| Notations: +
{WpsRESTBaseURL}: The base URL of the WPS REST endpoint. +
{process-id}: identifier of a process.  +
{job-id}: identifier to a job.
|=======================


=== Operations on WPS resources

In general, the HTTP GET operation is used to provide access to the resources described above.
However, in order to create a new job, the HTTP POST method is used to post a new job by sending a new job resource represented by
an execute request to the server. This results in the operations listed in <<table_wps_operations>> below.

[#table_wps_operations,reftext='{table-caption} {counter:table-num}']
.Operations on resources provided by the WPS REST server
[options="header"]
|=======================
| HTTP Operation        |Acccess Path                        | Parameters       |Description
| GET           | {WpsRESTBaseURL}                           | NA | Retrieval of Capabilities resource
| GET           | {WpsRESTBaseURL}/processes                 | NA | Retrieval of ProcessCollection resource
| GET | {WpsRESTBaseURL}/processes/{process-id} | NA | Retrieval of a Process resource (process description)
| GET | {WpsRESTBaseURL}/processes/{processID}/jobs | NA | Retrieval of list of jobs of a specific process (JobCollection)
| GET | {WpsRESTBaseURL}/processes/{processID}/jobs/{job-id} | NA | Retrieval of a single Job resource
| POST | {WpsRESTBaseURL}/processes/{processID}/jobs | Execute request (contained in body) | Execution of a process
4+^| Notations: +
{WpsRESTBaseURL}: The base URL of the WPS REST endpoint. +
{process-id}: identifier of a process.  +
{job-id}: identifier to a job.
|=======================

=== Associations between WPS resources

As stated above in the listing of resources (<<table_wps_resources>>), the basic
resources managed by the WPS REST server are processes, jobs, outputs and
its corresponding collections.
An overview on the associations between the resources is given in <<wps_resource_model>>.

[#wps_resource_model,reftext='{figure-caption} {counter:figure-num}']
.Resource model of the WPS REST server
image::figures/Figure1.png[WPS Resource Model]

The Capabilities has an association to the ProcessCollection that aggregates the single Processes offered by the Web Processing Server.
The process has an association to the collection of jobs (JobCollection) that aggregates single jobs, i.e. instances that run a certain process.

=== JSON Encoding

In the following, example requests and responses for the different operations and resources will be shown.

==== GetCapabilities

.Example of HTTP GET request for retrieving JSON WPS Capabilities.
[source]
----
http://hostname.org/wps-rest
----

.Example of WPS Capabilities encoded as JSON.
[source,json]
----
{
	"Capabilities": {
		"ServiceIdentification": {
			"Title": "RESTful WPS ",
			"Abstract": "Service implementing the WPS 2.0 REST/JSON binding extension",
			"ServiceType": "WPS",
			"ServiceTypeVersion": ["1.0.0",
			"2.0.0"],
			"Fees": "NONE",
			"AccessConstraints": "NONE"
		},
		"ServiceProvider": {
			"ProviderName": "OGC",
			"ProviderSite": {
				"HRef": "http://www.opengeospatial.org/"
			},
			"ServiceContact": {
				"IndividualName": "Your name",
				"ContactInfo": {
					
				}
			}
		},
		"Contents": {
			"ProcessSummaries": [{
				"identifier": "testbed12.fo.DouglasPeuckerAlgorithm",
				"title": "testbed12.fo.DouglasPeuckerAlgorithm",
				"processVersion": "1.0.0",
				"jobControlOptions": "sync-execute async-execute",
				"outputTransmission": "reference value",
				"processDescription": "http://hostname.org/wps-rest/processes/ConvexHullAlgorithm"
			},
			...]
		},
		"service": "WPS",
		"version": "2.0.0"
	}
}
----

The process summaries in the contents-section contain links to the process description of the respective process. The standalone list of processes can be requested as follows:

.Example of HTTP GET request for retrieving the list of offered processes encoded as JSON.
[source]
----
http://hostname.org/wps-rest/processes
----

.Example of Process list encoded as JSON.
[source,json]
----
{
  "ProcessSummaries": [
    {
      "identifier": "ConvexHullAlgorithm",
      "title": "Convex Hull Algorithm",
      "processVersion": "1.0.0",
      "jobControlOptions": "sync-execute async-execute",
      "processDescription": "http://hostname.org/wps-rest/processes/ConvexHullAlgorithm"
    },...
    ]
}
----

==== DescribeProcess

.Example of HTTP GET request for retrieving the process description of a process encoded in JSON. (NOTE: Request has been line-wrapped for easier reading).
[source]
----
http://hostname.org/wps-rest/processes/ConvexHullAlgorithm
----

.Example of WPS DescribeProcess encoded as JSON.
[source,json]
----
{
  "ProcessOffering": {
    "Process": {
      "Title": "Hootenanny Conflation Process",
      "Identifier": "testbed12.lsa.HootenannyConflation",
      "Input": [
        {
          "Title": "INPUT1",
          "Identifier": "INPUT1",
          "ComplexData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "application/x-zipped-shp"
              },...
            ]
          },
          "minOccurs": "1",
          "maxOccurs": "1"
        },
        {
          "Title": "INPUT1_TRANSLATION",
          "Identifier": "INPUT1_TRANSLATION",
          "ComplexData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "text/x-script.phyton"
              },
              {
                "default": "false",
                "mimeType": "text/plain"
              }
            ]
          },
          "minOccurs": "0",
          "maxOccurs": "1"
        },
        {
          "Title": "INPUT2",
          "Identifier": "INPUT2",
          "ComplexData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "application/x-openstreetmap+xml"
              }...
            ]
          },
          "minOccurs": "1",
          "maxOccurs": "1"
        },
        {
          "Title": "CONFLATION_TYPE",
          "Identifier": "CONFLATION_TYPE",
          "LiteralData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "text/plain"
              },
              {
                "default": "false",
                "mimeType": "text/xml"
              }
            ],
            "LiteralDataDomain": [
              {
                "AnyValue": null,
                "DataType": {
                  "reference": "xs:string"
                }
              }
            ]
          },
          "minOccurs": "0",
          "maxOccurs": "1"
        },...
      ],
      "Output": [
        {
          "Title": "CONFLATION_OUTPUT",
          "Identifier": "CONFLATION_OUTPUT",
          "ComplexData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "application/x-zipped-shp"
              },...
            ]
          }
        },
        {
          "Title": "CONFLATION_REPORT",
          "Identifier": "CONFLATION_REPORT",
          "ComplexData": {
            "Format": [
              {
                "default": "true",
                "mimeType": "text/plain"
              }
            ]
          }
        }
      ]
    },
    "processVersion": "1.0.0",
    "jobControlOptions": "sync-execute async-execute",
    "executeEndpoint": "http://hostname.org/wps-rest/processes/ConvexHullAlgorithm/jobs"
  }
}
----

.Example of HTTP GET request for getting a list of jobs of a process. 
[source]
----
http://hostname.org/wps-rest/processes/ConvexHullAlgorithm/jobs
----

.Example of a list of jobs for a process encoded as JSON.
[source,json]
----
{
  "Jobs": [
    "1317c058-cb4d-4ab4-ad21-b78e51229a17",
    "1319d2fc-cac8-4e8d-8039-2c511f55a9d3"
  ]
}
----

==== Execute

.Example of HTTP POST request for executing a process. 
[source]
----
http://hostname.org/wps-rest/processes/ConvexHullAlgorithm/jobs
----

By default, the proces will be executed asynchronously. If the process supports synchronous execution, this can be achieved by appending the following URL-parameter:

.Example of HTTP POST request for synchronously executing a process.
[source]
----
http://hostname.org/wps-rest/processes/ConvexHullAlgorithm/jobs?sync-execute=true
----

.Example of WPS Execute request encoded as JSON.
[source,json]
----
{
    "Execute": {
        "Input": [
            {
            "Reference": {
                    "mimeType": "application/x-zipped-shp",
                    "href": "http://geoprocessing.demo.52north.org:8080/data/Trans_RoadSegment-aoi.zip"
            },
            "id": "INPUT1"
            },
			{
            "Reference": {
                    "mimeType": "text/x-script.phyton",
                    "href": "http://geoprocessing.demo.52north.org:8080/data/TNM_Roads.py"
            },
            "id": "INPUT1_TRANSLATION"
            },
			{
            "Reference": {
                    "mimeType": "application/x-openstreetmap+xml",
                    "href": "http://geoprocessing.demo.52north.org:8080/data/sf_only_roads-aoi.osm"
            },
            "id": "INPUT2"
            }
        ],
        "output":[{
            "mimeType": "application/x-zipped-shp",
            "id": "CONFLATION_OUTPUT"
        },{
            "mimeType": "text/plain",
            "id": "CONFLATION_REPORT"
        }]
    }
}
----

The direct response to a asynchronously executed process is HTTP status code 201 (created) and the URL to obtain status information and finally the result. The URL will be returned in a HTTP header named __Location__. For synchronous execution, the result document will be returned after the process has finished.

==== GetStatus

.Example of HTTP GET request for retrieving status information about a asynchonously executed process (NOTE: Request has been line-wrapped for easier reading).
[source]
----
http://hostname.org/wps-rest/processes/
testbed12.fo.DouglasPeuckerAlgorithm/jobs/
c731d14b-1de6-499c-9317-20224e056012
----

.Example of WPS StatusInfo response encoded as JSON. The process is still running.
[source,json]
----
{
  "StatusInfo": {
    "JobID": "c731d14b-1de6-499c-9317-20224e056012",
    "Status": "Running",
    "Progress": 0
  }
}
----

After the process has finished, the progress element will be replaced by the URL to obtain the outputs

.Example of WPS StatusInfo response encoded as JSON. The process has finished.
[source,json]
----
{
  "StatusInfo": {
    "JobID": "c731d14b-1de6-499c-9317-20224e056012",
    "Status": "Succeeded",
    "Output": "http://hostname.org/wps-rest/processes/testbed12.lsa.HootenannyConflation/jobs/c731d14b-1de6-499c-9317-20224e056012/outputs"
  }
}
----

==== GetResult

.Example of WPS Result response encoded as JSON.
[source,json]
----
{
  "Result": {
    "JobID": "c731d14b-1de6-499c-9317-20224e056012",
    "Output": [
      {
        "ID": "CONFLATION_OUTPUT",
        "Reference": {
          "mimeType": "application/x-zipped-shp",
          "href": "http://hostname.org/wps/RetrieveResultServlet?id=c731d14b-1de6-499c-9317-20224e056012CONFLATION_OUTPUT.b1172b1c-c9aa-495a-aa8b-62220ac93605"
        }
      },
      {
        "ID": "CONFLATION_REPORT",
        "Reference": {
          "mimeType": "text/plain",
          "href": "http://hostname.org/wps/RetrieveResultServlet?id=c731d14b-1de6-499c-9317-20224e056012****CONFLATION_REPORT.220391a6-4357-44e2-b5f3-c0a0983cedae"
        }
      }
    ]
  }
}
----
